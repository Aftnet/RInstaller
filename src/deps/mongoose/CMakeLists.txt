set(CURRENT_TARGET_NAME mongoose)
add_library(${CURRENT_TARGET_NAME} STATIC)

target_include_directories(${CURRENT_TARGET_NAME}
PUBLIC
    src
PRIVATE
)

set(CURRENT_TARGET_PLATFORM_DEFINES
    MG_ENABLE_MBEDTLS=1
)

if(CMAKE_TOOLCHAIN_FILE)
    get_filename_component(CMAKE_TOOLCHAIN_FILENAME ${CMAKE_TOOLCHAIN_FILE} NAME)

    if(CMAKE_TOOLCHAIN_FILENAME STREQUAL "Switch.cmake")
        list(APPEND CURRENT_TARGET_PLATFORM_DEFINES
            MG_ARCH=MG_ARCH_UNIX
        )
    endif()
else()
    list(APPEND CURRENT_TARGET_PLATFORM_DEFINES
        MG_ENABLE_IPV6=1
    )
endif()

target_compile_definitions(${CURRENT_TARGET_NAME}
PUBLIC
    ${CURRENT_TARGET_PLATFORM_DEFINES}
)

set(CURRENT_TARGET_SOURCES
    src/mongoose.h
    src/mongoose.c
)

target_sources(${CURRENT_TARGET_NAME}
PRIVATE
    ${CURRENT_TARGET_SOURCES}
)

source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${CURRENT_TARGET_SOURCES})

target_link_libraries(${CURRENT_TARGET_NAME}
PUBLIC
    mbedtls
)
